var C=Object.defineProperty;var T=(e,t,a)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var p=(e,t,a)=>T(e,typeof t!="symbol"?t+"":t,a);import{ag as u,ah as k,ai as x,aj as b,ak as j,al as A,F as f,q as $,am as w,r as N,t as v,j as s,H as Q,w as W,x as M,b as S}from"./index-CZfeFpFF.js";import{r as Z,L as P}from"./router-ji7Lkway.js";import{T as D}from"./SocialProof-qZkkTpQc.js";import{M as E}from"./TrustSignals-DhYlgKdg.js";class F{constructor(){p(this,"preloadQueue",[]);p(this,"isProcessing",!1);p(this,"preloadedItems",new Set)}async preloadProduct(t,a={}){const{priority:l="medium",timeout:o=8e3,force:n=!1}=a,i=`product-${t}`;if(this.preloadedItems.has(i)&&!n)return;if(u.has(i)&&!n){this.preloadedItems.add(i);return}const h=async()=>{try{console.log(`ðŸš€ Preloading product ${t}...`);const r=await Promise.race([k(t),new Promise((g,c)=>setTimeout(()=>c(new Error("Preload timeout")),o))]);r&&(u.set(i,r,300*1e3),this.preloadedItems.add(i),console.log(`âœ… Preloaded product ${t}`))}catch(r){console.warn(`âš ï¸ Failed to preload product ${t}:`,r)}};l==="high"?this.preloadQueue.unshift(h):this.preloadQueue.push(h),this.processQueue()}async preloadCategoryProducts(t,a={}){const{priority:l="low",timeout:o=8e3,force:n=!1}=a,i=`category-products-${t}`;if(this.preloadedItems.has(i)&&!n)return;const h=async()=>{try{console.log(`ðŸš€ Preloading products for category ${t}...`);const r=await Promise.race([x({categoryId:t,limit:12}),new Promise((g,c)=>setTimeout(()=>c(new Error("Preload timeout")),o))]);r&&r.length>0&&(u.set(i,r,180*1e3),this.preloadedItems.add(i),console.log(`âœ… Preloaded ${r.length} products for category ${t}`))}catch(r){console.warn(`âš ï¸ Failed to preload category products ${t}:`,r)}};l==="high"?this.preloadQueue.unshift(h):this.preloadQueue.push(h),this.processQueue()}async preloadNextPage(t,a=12,l={}){const{timeout:o=1e4}=l,n=t+a,i=`products-page-${n}-${a}`;if(this.preloadedItems.has(i))return;const h=async()=>{try{console.log(`ðŸš€ Preloading next page (offset: ${n})...`);const r=await Promise.race([x({limit:a,offset:n}),new Promise((g,c)=>setTimeout(()=>c(new Error("Preload timeout")),o))]);r&&r.length>0&&(u.set(i,r,120*1e3),this.preloadedItems.add(i),console.log(`âœ… Preloaded next page with ${r.length} products`))}catch(r){console.warn("âš ï¸ Failed to preload next page:",r)}};this.preloadQueue.push(h),this.processQueue()}async preloadEssentials(){const t=async()=>{try{console.log("ðŸš€ Preloading essential data...");const a=b("categories");if(!j.has(a)){const o=await A();j.set(a,o),console.log("âœ… Preloaded categories")}const l=b("products-featured");if(!u.has(l)){const o=await x({featured:!0,limit:8});u.set(l,o),console.log("âœ… Preloaded featured products")}}catch(a){console.warn("âš ï¸ Failed to preload essentials:",a)}};this.preloadQueue.unshift(t),this.processQueue()}async processQueue(){if(!(this.isProcessing||this.preloadQueue.length===0)){for(this.isProcessing=!0;this.preloadQueue.length>0;){const t=this.preloadQueue.shift();if(t){try{await t()}catch(a){console.warn("Preload task failed:",a)}await new Promise(a=>setTimeout(a,100))}}this.isProcessing=!1}}clear(){this.preloadQueue=[],this.preloadedItems.clear(),this.isProcessing=!1,console.log("ðŸ§¹ Cleared preloader cache and queue")}getStats(){return{queueLength:this.preloadQueue.length,preloadedItems:this.preloadedItems.size,isProcessing:this.isProcessing}}smartPreload(t){const{currentPage:a,userScrollPosition:l=0,timeOnPage:o=0}=t;o>1e4&&l>.5&&a==="products"&&this.preloadNextPage(0),a==="home"&&o>5e3&&this.preloadEssentials(),a!=null&&a.startsWith("product-")&&o>3e3&&console.log("Product page detected, could preload related products")}}const I=new F;typeof window<"u"&&setTimeout(()=>{I.preloadEssentials()},2e3);const L=()=>{const{user:e}=f(),{addItem:t}=$(),{showAuthModal:a}=w();return{handleAddToCart:(o,n=1)=>{e?t(o,n):a(o,"cart")}}},B=()=>{const{user:e}=f(),{addItem:t}=N(),{showAuthModal:a}=w();return{handleAddToWishlist:o=>{e?t(o):a(o,"wishlist")}}},O=()=>{const{user:e}=f(),{addItem:t}=v(),{showAuthModal:a}=w();return{handleAddToCompare:o=>{e?t(o):a(o,"compare")}}},q=({product:e})=>{const{isInWishlist:t}=N(),{isInCompare:a}=v(),{handleAddToCart:l}=L(),{handleAddToWishlist:o}=B(),{handleAddToCompare:n}=O(),[i,h]=Z.useState(0),r=d=>{d.stopPropagation(),d.preventDefault(),o(e)},g=d=>{d.stopPropagation(),d.preventDefault(),n(e)},c=e.originalPrice?Math.round((e.originalPrice-e.price)/e.originalPrice*100):0;return s.jsxs("div",{className:"product-card group flex flex-col h-full bg-white rounded-lg sm:rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200 border border-gray-100 touch-manipulation",onMouseEnter:()=>{I.preloadProduct(e.id,{priority:"high"})},children:[s.jsxs("div",{className:"relative overflow-hidden group/image bg-gray-50",children:[s.jsx(P,{to:`/products/${e.id}`,className:"block",children:s.jsxs("div",{className:"aspect-[4/3] relative overflow-hidden",children:[s.jsx("img",{src:e.images[i]||e.images[0],alt:e.name,className:"w-full h-full object-cover",loading:"lazy",crossOrigin:"anonymous",onError:d=>{const m=d.target;m.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2Y5ZmFmYiIvPgogIDx0ZXh0IHg9IjIwMCIgeT0iMjAwIiBmb250LXNpemU9IjE2IiBmaWxsPSIjNjM3MzgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2UgTm90IEZvdW5kPC90ZXh0Pgo8L3N2Zz4="}},i),e.images.length>1&&s.jsx("div",{className:"absolute bottom-1.5 sm:bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 sm:space-x-1.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.images.map((d,m)=>s.jsx("button",{onClick:y=>{y.preventDefault(),y.stopPropagation(),h(m)},className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full transition-all duration-150 ${m===i?"bg-white shadow-md":"bg-white/70 hover:bg-white/90"}`,"aria-label":`View image ${m+1}`},`image-nav-${e.id}-${m}`))}),s.jsx("div",{className:"absolute inset-0 bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"})]})}),s.jsxs("div",{className:"absolute top-2 left-2 flex flex-col space-y-1 z-10",children:[c>0&&s.jsxs("span",{className:"bg-red-600 text-white text-[10px] px-1.5 py-0.5 rounded font-medium shadow-sm",children:["-",c,"% OFF"]}),e.featured&&s.jsx(D,{isHot:!0,className:"shadow-sm"}),e.stock<=0&&s.jsx("span",{className:"bg-gray-500 text-white text-[10px] px-1.5 py-0.5 rounded font-medium shadow-sm",children:"Out of Stock"})]}),s.jsxs("div",{className:"absolute top-1.5 sm:top-2 right-1.5 sm:right-2 flex flex-col space-y-1 sm:space-y-1.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[s.jsx("button",{onClick:r,className:`p-1 sm:p-1.5 rounded-full shadow-sm border transition-colors duration-200 ${t(e.id)?"bg-red-50 text-red-600 border-red-200":"bg-white text-gray-600 hover:text-red-500 border-gray-200 hover:border-red-200"} touch-manipulation`,children:s.jsx(Q,{className:`h-3 w-3 sm:h-3.5 sm:w-3.5 ${t(e.id)?"fill-current":""}`})}),s.jsx("button",{onClick:g,className:`p-1 sm:p-1.5 rounded-full shadow-sm border transition-colors duration-200 ${a(e.id)?"bg-blue-50 text-blue-600 border-blue-200":"bg-white text-gray-600 hover:text-blue-500 border-gray-200 hover:border-blue-200"} touch-manipulation`,children:s.jsx(W,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5"})})]}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-1.5 sm:p-2 transform translate-y-full group-hover:translate-y-0 transition-transform duration-200 bg-gradient-to-t from-white via-white/95 to-transparent",children:s.jsxs("button",{onClick:d=>{d.stopPropagation(),d.preventDefault(),e.stock>0&&l(e)},disabled:e.stock===0,className:`w-full flex items-center justify-center space-x-1 px-2 py-1.5 sm:px-3 sm:py-2 rounded-md sm:rounded-lg font-medium transition-colors duration-200 ${e.stock===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-orange-500 text-white hover:bg-orange-600 shadow-sm active:bg-orange-700"} touch-manipulation`,children:[s.jsx(M,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5"}),s.jsx("span",{className:"text-[10px] sm:text-xs font-medium",children:e.stock===0?"Out of Stock":"Add to Cart"})]})})]}),s.jsxs("div",{className:"p-2.5 sm:p-3 flex flex-col flex-grow space-y-1.5 sm:space-y-2",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-[10px] sm:text-xs text-gray-600 uppercase tracking-wide font-medium",children:e.category}),s.jsx(P,{to:`/products/${e.id}`,children:s.jsx("h3",{className:"text-xs sm:text-sm font-medium text-gray-900 line-clamp-2 leading-4 group-hover:text-blue-600 transition-colors duration-200",children:e.name})})]}),s.jsx("div",{className:"flex-grow"}),s.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[s.jsxs("div",{className:"flex items-center space-x-0.5 sm:space-x-1",children:[[...Array(5)].map((d,m)=>s.jsx(S,{className:`h-2.5 w-2.5 sm:h-3 sm:w-3 ${m<Math.floor(e.rating)?"text-yellow-400 fill-current":"text-gray-300"}`},`star-${e.id}-${m}`)),s.jsxs("span",{className:"text-[10px] text-gray-600 ml-0.5",children:["(",e.rating,")"]})]}),s.jsxs("div",{className:"flex items-center space-x-1.5",children:[s.jsxs("span",{className:"text-sm sm:text-base font-bold text-gray-900",children:["â‚¹",e.price.toLocaleString("en-IN")]}),e.originalPrice&&s.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 line-through",children:["â‚¹",e.originalPrice.toLocaleString("en-IN")]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:`text-[10px] font-medium ${e.stock>0?"text-green-600":"text-red-500"}`,children:e.stock>0?e.stock>10?"In Stock":`Only ${e.stock} left`:"Out of stock"}),c>0&&s.jsxs("span",{className:"bg-red-100 text-red-700 text-[10px] font-semibold px-1 py-0.5 rounded",children:[c,"% OFF"]})]}),s.jsx("div",{className:"pt-1.5 border-t border-gray-100",children:s.jsx(E,{freeShipping:e.price>=2e3,warranty:!0,returns:!0,className:"justify-center scale-75"})})]})]})]})};export{q as P,B as a,I as d,L as u};
